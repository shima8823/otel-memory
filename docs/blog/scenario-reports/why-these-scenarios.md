# シナリオ選定の設計思想

このドキュメントは、`docs/blog/scenario-reports/paper-structure.md` の
「なぜ複数シナリオが必要か（原因の切り分け）」を具体化するための設計メモです。

本記事では、シナリオを単なる再現ネタとしてではなく、
実務で使える診断力を育てる教材として選定します。

## 1. なぜ複数シナリオが必要か

同じ「メモリ高騰」でも、原因は複数あります。

- 入力過多で処理が追いつかない
- 保持待ちが長くバッファが増える
- 属性の組み合わせ増加で状態が膨張する
- 下流停止でキューが滞留する

見た目が似たメトリクスでも、主因が違えば対処は変わります。
この切り分けを学ぶために、複数シナリオを扱います。

## 2. シナリオ選定に使う7つの視点

### 2.1 再現性

誰が実行しても、同じ傾向の症状が出るかを重視します。
必要な設定ファイル、コマンド、負荷条件を固定し、手順を短く保てるシナリオを採用します。

### 2.2 観測可能性

症状だけでなく、原因構造まで追えることを重視します。
`otelcol_*` メトリクスで異常を捉え、pprof で「どの構造が膨らんだか」を説明できるものを選びます。

### 2.3 単因子性

主原因を1つに寄せて説明できることを重視します。
複合要因が強すぎるケースは、導入教材ではなく応用編で扱います。

### 2.4 調整可能性

パラメータ変更で改善を確認できることを重視します。
「何を変えると、どのメトリクスがどう変わるか」を示しやすいシナリオを優先します。

### 2.5 実務頻度

現場で実際に起きやすい事故を優先します。
再現が面白いだけで、実務でほぼ起きないケースは優先度を下げます。

### 2.6 教育的価値

1つのシナリオの学びが、別コンポーネントに転用できるかを重視します。
個別知識ではなく、原因分類の型を学べるものを採用します。

### 2.7 コスト対効果

準備コストと説明コストに対して、得られる理解が大きいかを重視します。
短い手順で深い洞察を得られるシナリオを優先します。

## 3. 原因分類の基本方針

本記事では、原因を「症状とデータ構造」から分類します。

- キュー滞留型: 送信待ちの増加によりメモリが上がる
- 状態膨張型: ステートフル処理で内部状態が増え続ける
- 保持遅延型: 判定待ちやバッチ待ちでデータ保持が長引く

7つの視点は、この分類を教材として成立させるための観点です。

## 4. 本記事で扱う代表シナリオ


## 5. 各シナリオを説明するときの共通フォーマット

各シナリオ本文は、次の順で記述します。

1. 再現手順（再現性）
2. 観測ポイント（観測可能性）
3. 主因の特定（単因子性）
4. パラメータ調整と再観測（調整可能性）
5. 実務での発生パターンと監視（実務頻度）
6. 他シナリオへの転用（教育的価値）
7. 最小手順での学びの要約（コスト対効果）
